{% extends 'base.html' %}

{% block content %}
  <!-- Title -->
  <div class="card card-body p-2">
    <h4 class="card-text text-center">
      <span id="prev">
        <button type="button" id="prevButton" style="background-color:transparent; border-color:transparent;">
          <i class="fas fa-angle-left"></i>
        </button>
      </span>
      <span id="title"></span>
      <span id="next">
        <button type="button" id="nextButton" style="background-color:transparent; border-color:transparent;">
          <i class="fas fa-angle-right"></i>
        </button>
      </span>
    </h4>
    <p id="userInfo" class="lead text-center p-0 m-0">User</p>
  </div>
  <!-- Chart -->
  <div class="card my-2">
    <div class="card-img-top">
      <canvas id="chart" class="card-text m-0"></canvas>
    </div>
  </div>
  <!-- Statistics -->
  <div class="card my-2">
    <div class="card-body">
      <h5 class="card-title">Statistische Daten</h5>
        {% include 'statistics.html' %}
    </div>
  </div>
  <!-- Table -->
  <div class="card my-2">
    <div class="card-body">
      <h5 class="card-title">Zählwerte</h5>
      <div class="card-text table-responsive">
        {% include 'table.html' %}
      </div>
    </div>
  </div>
{% endblock %}

{% block contentjs %}
  <script>
      document.getElementById('changePrice').onclick = calcPrice;

      function calcPrice() {
          let priceCollection = document.getElementsByClassName('cost');
          const diffCollection = document.getElementsByClassName('diff');
          const price = document.getElementById("priceInput").value / 100;
          const res = document.getElementById("resSelector").value;

          let priceSum = price * {{ g.data['sum'] }};
          document.getElementById('cost').innerText = `${priceSum.toFixed(2)} €`;

          for (let i = 0; i < priceCollection.length; i++) {
              let cost = 0.0;
              {% if g.fmt == 'day' %}
                  cost = parseFloat(diffCollection[i].innerHTML) * price / 24;
              {% elif g.fmt == 'month' %}
                  cost = parseFloat(diffCollection[i].innerHTML) * price / 12;
              {% else %}
                  cost = parseFloat(diffCollection[i].innerHTML) * price / 60 * parseInt(res);
              {% endif %}

              priceCollection[i].innerHTML = cost.toFixed(3)
          }
      }

      calcPrice();
  </script>
{% endblock %}