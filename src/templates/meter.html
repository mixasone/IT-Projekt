{% extends 'base.html' %}

{% block content %}
  <!-- Title -->
  <div class="card card-body p-2">
    <h4 class="card-text text-center">
                            <span id="prev"><button type="button" id="prevButton" onclick="decreaseDate()"
                                                    style="background-color:transparent; border-color:transparent;">
                                <i class="fas fa-angle-left"></i>
                            </button></span>
      <span id="title"></span>
      <span id="next"><button type="button" id="nextButton" onclick="increaseDate()"
                              style="background-color:transparent; border-color:transparent;">
                                <i class="fas fa-angle-right"></i>
                            </button></span>
    </h4>
    <p id="userInfo" class="lead text-center p-0 m-0">User</p>
  </div>
  <!-- Chart -->
  <div class="card my-2">
    <div class="card-img-top">
      <canvas id="chart" class="card-text m-0"></canvas>
    </div>
  </div>
  <!-- Statistics -->
  <div class="card my-2">
    <div class="card-body">
      <h5 class="card-title">Statistische Daten</h5>
      <div class="row" id="statData"></div>
    </div>
  </div>
  <!-- Table -->
  <div class="card my-2">
    <div class="card-body">
      <h5 class="card-title">Zählwerte</h5>
      <div class="card-text table-responsive">
        <table class="table table-striped table-sm table-hover text-center">
          <tr class="d-flex">
            <th class="col">{{ title }}</th>
            <th class="col">Lastgang [{{ unit }}]</th>
            <th class="col">Zählerstand [kWh]</th>
            <th class="col">Kosten [€]</th>
          </tr>
          {% for meter in meters %}
            <tr class="d-flex">
              {% if g.day is defined %}
                <td class="col">{{ meter.datetime|datetime('day') }}</td>
              {% elif g.month is defined %}
                <td class="col">{{ meter.datetime|datetime('month') }}</td>
              {% else %}
                <td class="col">{{ meter.datetime|datetime }}</td>
              {% endif %}
              <td class="col diff">{{ meter.diff }}</td>
              <td class="col">{{ meter.reading }}</td>
              <td class="col price">-,--</td>
            </tr>
          {% endfor %}
        </table>
      </div>
    </div>
  </div>
{% endblock %}

{% block contentjs %}
  <script>
      const requestMode = '{{ mode }}';

      document.getElementById('changePrice').onclick = calcPrice;

      function calcPrice() {
          let priceCollection = document.getElementsByClassName('price');
          const diffCollection = document.getElementsByClassName('diff');
          const price = document.getElementById("priceInput").value / 100;
          const res = document.getElementById("resSelector").value;

          for (let i = 0; i < priceCollection.length; i++) {
              let cost = 0.0;
              switch (requestMode) {
                  case 'day':
                      cost = parseFloat(diffCollection[i].innerHTML) * price / 60 * parseInt(res);
                      break;
                  case 'interval':
                  case 'month':
                      cost = parseFloat(diffCollection[i].innerHTML) * price / 24;
                      break;
                  default:
                      cost = parseFloat(diffCollection[i].innerHTML) * price / 12;
                      break;
              }

              priceCollection[i].innerHTML = cost.toFixed(3)
          }
      }

      calcPrice();
  </script>
{% endblock %}